# 《UNIX环境高级编程》第一章学习笔记
1. 文件系统：UNIX文件系统是目录和文件的一种层次结构，所有东西的起点是根目录，这个目录的名字是“/”。
2. 目录：目录是一个包含目录项的文件，可以认为每个目录项都包含一个文件名，同时还有说明该文件属性的信息。文件属性指文件类型，文件大小，文件所有者，文件权限以及修改时间等。
3. 文件名：目录中的各个名字为文件名，斜线和空字符不能出现在文件名中，POSIX.1将文件名限制在以下字符集之内：字母，数字，点，短横线，下划线。创建目录时会自动创建两个文件名".",".."分别表示当前目录和上一级目录。在根目录中这两个意义相同。
4. 路径名：有斜线分隔的一个或多个文件名组成的序列，以斜线开头的成为绝对路径，否则为相对路径。
5. opendir函数返回指向DIR结构的指针，将这个指针传递给readdir函数，然后在循环中使用readdir函数读取每个目录项。readdir返回一个指向dirent结构的指针，当前目录中无目录项是返回NULL，使用目录项的名字d_name，可以调用stat函数获取这个文件的所有属性。

### 文件描述符（file descriptor）
   文件描述符通常是一个小的非负整数，内核用以标记一个特定进程正在使用的文件。当内核打开或者创建一个文件的时候都会返回一个文件描述符，读写这个文件时可以使用这个文件描述符。

### 标准输入，标准输出，标准错误（stdin, stdout, stderr）
   一个新程序运行时，shell都会为其打开三个文件描述符，标准输入（standard input），标准输出（standard output），标准错误（standard error）。如果不做处理，这三个描述符都连向终端，使用shell可以将这三个描述符重定向到某个文件。

### 不带缓冲的I/O
   函数open，write，read，lseek，close提供了不带缓冲的I/O，这些函数都使用文件描述符。

6. 头文件<unistd.h>包含了很多UNIX系统服务的函数原型，例如read和write。
7. STDIN_FILENO和STDOUT_FILENO定义在<unistd.h>中，制定了标准输入和标准输出的文件描述符，POSIX中它们的值为0，1.
8. read函数返回读取到的字节数，读到文件尾端时返回0，出现错误返回-1.
### 标准I/O为那些不带缓冲的I/O提供了一个带缓冲的接口
   使用标准I/O简化了对输入行的处理。
### 程序（program）
   程序是储存在磁盘上的可执行文件，内核使用exec函数（共有7个）将程序读入内存并执行。
### 进程 （process）
   程序的执行实例被称为进程。UNIX系统保证每个进程都有一个唯一的数字标识，成为进程ID（process ID），进程ID总是一个非负整数。

9. getpid函数返回当前进程的PID。
10. fork函数创建一个新的进程，称为子进程，调用进程称为父进程，fork函数调用一次但返回两次，在父进程中返回新创建的子进程的进程ID，在子进程中返回0。子进程是父进程的副本，所以他将获得父进程的数据空间，堆，栈等资源的副本（子进程持有的是上述资源的副本），父子进程间不共享这些储存空间。
### fork函数返回两次的原因
   UNIX将复制父进程的地址空间内容给子进程，因此子进程拥有独立的地址空间。由于在负值时复制了父进程的堆栈段，所以两个进程都停留在fork函数中，等待返回，因此fork函数会分别在父进程和子进程中返回。
### 线程和线程ID
   通常一个进程只有一个控制线（thread）--某一时刻执行的一组机器指令。对于某些问题，如果有多个控制线程分别作用于它的不同部分，这个问题解决起来就容易很多，而且多个控制线程可以充分利用多处理器系统的并行能力。
   一个进程内的所有线程共享同一地址空间，文件描述符，栈以及进程相关的属性。因为他们能访问同一个储存区，所以个线程在访问共享数据时要采取同步措施以避免不一致性。
   线程也用ID标识，但是线程ID只在他所属的进程内起作用，一个进程中的线程ID在另一个进程中没有意义。

### char *strerror(int errnum);
   返回指向消息字符串的指针。
### void perror(const char *msg);
   perror是基于当前的errorn的值，先输出由msg指向的字符串，然后是一个冒号，一个空格，接着是对应于errorn的出错消息，最后是一个换行符。
### 出错回复
   可以将<errno.h>中的错误分为两类：**致命性错误**和**非致命性错误**。对于致命性错误，无法执行恢复动作，最多只能在用户屏幕上打印一条错误信息，或者将出错信息写入日志文件，然后退出。对于非致命性错误，有时可以妥善处理，大多数非致命性错误都是暂时的。比如资源短缺。

### 用户ID
   用户ID是一个数值，它向操作系统标识各个不同的用户，系统管理员再确定一个用户的登录名时确定其用户ID，用户不能自行更改，不同的用户有不同的ID，ID为0的用户为超级用户(root)。

### 信号
   信号（signal）通知操作系统发生了某种情况。有三种处理信号的方式：
1. 忽略信号。
2. 按照系统默认的方式处理。
3. 提供一个函数，信号发生时自动调用这个函数，被称为捕捉信号。

### 时间值

历史上，UNIX系统使用过两种不同的时间值。
1. 日历时间。该值是自协调世界时(UTC) 1970年1月1日00:00:00这个特定时间以来所经历的秒数，这些时间值可以用于记录文件最近的一次修改时间。
2. 进程时间。也被称为CPU时间，用以度量进程使用的CPU资源，进程时间以时间滴答计算，每秒曾取值为50，60，或100个时钟滴答。clock_t用来保存这种时间值。
   UNIX为一个进程维护了三个进程时间值
+ 时钟时间。（墙上时钟时间），是进程运行的时间总量，其值与系统中进程运行的进程数量有关。
+ 用户CPU时间。指用户执行命令所用的时间量。
+ 系统CPU时间。指系统为当前进程执行内核所经历的时间。

### 系统调用和库函数
   系统提供良好定义，数量有限，直接进入内核的入口点，这些入口点被称为系统调用（system call）。
   UNIX系统所使用的技术是为每个系统调用在C标准库中设置一个具有相同名字的函数。用户进程用标准C调用序列来调用这些函数，然后函数调用相关内核服务。
   从实现角度，系统调用和库文件有着本质的区别，但是从应用角度考虑，可以将系统调用是为C函数。
   系统调用通常提供一种最小的接口，而库函数通常提供比较复杂的功能。
   UNIX系统对于时间的处理只提供一个系统调用返回UNIX元年到当前时间的秒数，具体的堆这个数值的解读则有各种库函数和夏令时算法完成。
   
### 课后习题
1. 在根目录执行 cd .和cd ..运行结果相同，说明根目录的.和..是相同的，同理在其他目录执行会发现结果不同。
2. UNIX可以同时执行多个任务，852和853可能被其他进程占用。
3. 个人见解：const char * 是为了防止msgb被修改，而errnum是值传递，因此不需要const。
4. T = 1970/1/1 00:00:00，t = 2^31 / (60 * 60 * 24 * 100) = 68天。T + t = 2038年。
5. t = 2^31 / (60 * 60 * 24 * 100) ~= 249天

